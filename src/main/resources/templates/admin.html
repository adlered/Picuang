<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<html lang="en">
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ›Picuang - æ°¸ä¹…å…è´¹ | å…ç™»å½•å›¾åºŠ</title>
    <link href="/favicon.png" rel="icon">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap/cover.css" rel="stylesheet">

    <script src="/js/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/clipboard.js"></script>

    <meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<div class="site-wrapper">
    <div class="site-wrapper-inner">
        <div class="cover-container">
            <div class="masthead clearfix">
                <div class="inner">
                    <a href="/"><h3 class="masthead-brand">å¿…åºŠ Picuang</h3></a>
                    <nav>
                        <ul class="nav masthead-nav">
                            <li id="logout" style="display: none"><a href="javascript:logout();">æ³¨é”€</a></li>
                            <li><a href="/">ä¸Šä¼ </a></li>
                            <li><a href="/history">å†å²</a></li>
                            <li class="active"><a href="/admin">ç®¡ç†</a></li>
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="inner cover">
                <div id="admin" style="margin-top: 36px; margin-bottom: 36px;">
                    <div id="message"></div>
                    <div id="config" style="display: none">
                        <div class="row" id="config-row">
                        </div>
                        <hr style="filter: alpha(opacity=100,finishopacity=0,style=3); margin-top: 36px; margin-bottom: 36px;" width="95%" color="#6f5499" size="3" />
                        <div class="config-buttons">
                            <div class="btn-group btn-group-justified" role="group" aria-label="...">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-default" onclick="exportConfig()">å¯¼å‡ºé…ç½®</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-primary">ä»…å…è®¸ç®¡ç†å‘˜ä¸Šä¼  (å½“å‰ï¼šå¦)</button>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-default">å¯¼å…¥é…ç½®</button>
                                </div>
                            </div>
                        </div>
                        <hr style="filter: alpha(opacity=100,finishopacity=0,style=3); margin-top: 36px; margin-bottom: 36px;" width="95%" color="#6f5499" size="3" />
                        <div class="help">
                            <div class="col-md-12">
                                <h4>Qï¼šå¦‚ä½•ä¿®æ”¹æˆ‘çš„ä¸Šä¼ å¤§å°é™åˆ¶ï¼Ÿ</h4>
                                <p>Aï¼šè¯·ç¼–è¾‘æ–‡ä»¶ "<span th:text="${appConfLocation}"></span>"<br>
                                    ä¿®æ”¹ "spring.servlet.multipart.max-file-size" å’Œ "spring.servlet.multipart.max-request-size" é€‰é¡¹<br>
                                    å‡å¦‚é™åˆ¶å¤§å°ä¸º10MBï¼Œåˆ™å°†ä¸¤ä¸ªé”®çš„å€¼å…¨éƒ¨æ”¹ä¸º"10MB"ï¼Œé‡å¯æœåŠ¡å™¨åå°±ä¼šç”Ÿæ•ˆã€‚<br>
                                    å¦‚æœé‡å¯æœåŠ¡å™¨åä¸ç”Ÿæ•ˆæˆ–ä»æœ‰é—®é¢˜ï¼Œè¯·å‚é˜…<a href="https://github.com/AdlerED/Picuang#rotating_light-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank"><b>è¿™é‡Œ</b></a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function exportConfig() {
                    window.open("/api/admin/export");
                }

                $(function () {
                    axios.get('/api/admin/init')
                        .then(function (response) {
                                if (response.data.code === 500) {
                                    $("#message").html("ç®¡ç†å¯†ç æœªè®¾ç½®ï¼Œæ— æ³•è¿›å…¥æ§åˆ¶å°ï¼<br>è¯·ç¼–è¾‘æ–‡ä»¶ '" + response.data.data + "'<br>ä¸­ 'password' çš„å€¼ï¼Œç„¶åé‡å¯æœåŠ¡ç«¯ã€‚");
                                } else {
                                    axios.get('/api/admin/check')
                                        .then(function (response) {
                                                if (response.data.code === 200) {
                                                    showConfig();
                                                } else {
                                                    showLogin();
                                                }
                                            }
                                        );
                                }
                            }
                        );
                });

                function adminLogin() {
                    var password = $("#admin-password").val();
                    var data = new FormData();
                    data.append("password", password);
                    axios.post('/api/admin/login', data)
                        .then(function (response) {
                                if (response.data.code === 200) {
                                    $("#admin-password").css("border-color", "green");
                                    $("#admin-button").css("border-color", "green");
                                    $("#admin-icon").removeClass();
                                    $("#admin-icon").addClass("glyphicon glyphicon-ok");
                                    $("#admin-password").hide(100);
                                    $("#admin-button").hide(100);
                                    showConfig();
                                } else {
                                    $("#admin-password").css("border-color", "red");
                                    $("#admin-button").css("border-color", "red");
                                    $("#admin-icon").removeClass();
                                    $("#admin-icon").addClass("glyphicon glyphicon-remove");
                                }
                            }
                        );
                }

                function logout() {
                    axios.get('/api/admin/logout')
                        .then(function (response) {
                                location.href = "/";
                            }
                        );
                }

                function showLogin() {
                    $("#message").html("<div class='row'><div class='col-lg-12'><div class='input-group'><input id='admin-password' class='form-control' placeholder='è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ' type='text'><span class='input-group-btn'><button id='admin-button' class='btn btn-default' type='button' onclick='adminLogin()'><i id='admin-icon' class='glyphicon glyphicon-record'></i></button></span></div></div></div>");
                    $("#admin-password").keyup(function (event) {
                        if (event.keyCode === 13) {
                            adminLogin();
                        }
                    });
                }

                function showConfig() {
                    axios.get('/api/admin/getConf?conf=imageUploadedCount')
                        .then(function (response) {
                            $("#config-row").prepend("<div class='col-lg-6'><div class='input-group'><span class='input-group-addon' style='text-shadow: none !important;'>ç´¯è®¡å­˜å‚¨å›¾ç‰‡æ•°</span><input id='imageUploadedCount-input' aria-label='...' class='form-control' type='text' value='" + response.data + "'><span class='input-group-btn'><button class='btn btn-default' type='button' onclick='editConfig(\"imageUploadedCount\")'>ä¿®æ”¹</button></span></div></div>");
                        });
                    axios.get('/api/admin/getConf?conf=password')
                        .then(function (response) {
                            $("#config-row").prepend("<div class='col-lg-6'><div class='input-group'><span class='input-group-addon' style='text-shadow: none !important;'>ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </span><input id='password-input' aria-label='...' class='form-control' type='text' value='" + response.data + "'><span class='input-group-btn'><button class='btn btn-default' type='button' onclick='editConfig(\"password\")'>ä¿®æ”¹</button></span></div></div>");
                        });
                    $("#logout").fadeIn(200);
                    $("#config").fadeIn(100);
                }

                function editConfig(sheet) {
                    var value = $("#" + sheet + "-input").val();
                    axios.get('/api/admin/setConf?conf=' + sheet + '&value=' + value);
                    sendInnerNotify(sheet + " çš„å€¼å·²æˆåŠŸä¿®æ”¹ä¸ºï¼š" + value);
                }
            </script>

            <div class="mastfoot">
                <div class="inner">
                    <p>
                        <script src="https://js.users.51.la/20181641.js" type="text/javascript"></script>
                        <br>
                        <a href="http://beian.miit.gov.cn" style="text-decoration: none;"
                           target="_blank">äº¬ICPå¤‡18063791å·</a>
                        <br>
                        <a href="https://github.com/AdlerED" style="text-decoration: none;" target="_blank"><strong>GitHub:
                            AdlerED</strong></a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/js/user/clipboard-control.js"></script>
<script src="/js/user/click-listen.js"></script>
<script src="/js/user/common-queue.js"></script>
<script src="/js/user/drag-and-drop.js"></script>
<script src="/js/user/on-paste.js"></script>
<script src="/js/user/notify.js"></script>
<script src="/js/d-toast.min.js"></script>
<script src="/js/axios.min.js"></script>
<script src="/js/fantastic-progress-bar-bootstrap.js"></script>
</body>
</html>